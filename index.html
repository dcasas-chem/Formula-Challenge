<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formula Challenge</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Space Grotesk & Barlow -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --theme-color-600: #5dd699;
            --theme-color-800: #10b981; /* Tailwind green-500 */
            --theme-gradient-from: #5dd699;
            --theme-gradient-to: #34d399; /* Tailwind green-400 */
            --theme-shadow-color: 'rgba(93, 214, 153, 0.5)';
            --theme-focus-ring-color: #5dd699;
            --theme-bg-from: #ecfdf5; /* Tailwind green-50 */
            --theme-bg-to: #f0fdfa; /* Tailwind teal-50 */
        }
        body {
            font-family: 'Barlow', sans-serif;
            background: linear-gradient(135deg, var(--theme-bg-from), var(--theme-bg-to));
            color: #1f2937; /* gray-800 */
            transition: background 0.5s ease;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Space Grotesk', sans-serif;
        }
        .glass-container {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }
        .selection-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            cursor: pointer;
        }
        .selection-card.selected {
            transform: translateY(-4px);
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
            --tw-ring-color: var(--theme-color-600);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        input[type="number"], input[type="text"] {
            -moz-appearance: textfield;
            background-color: #f8fafc;
            border: 1px solid #cbd5e1;
            color: #1e293b;
            font-family: 'Barlow', sans-serif;
        }
        .btn-primary {
            background: linear-gradient(45deg, var(--theme-gradient-from), var(--theme-gradient-to));
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--theme-shadow-color);
        }
        /* Dynamic Theme Classes */
        .text-theme { color: var(--theme-color-600); }
        .hover\:text-theme-dark:hover { color: var(--theme-color-800); }
        .focus\:ring-theme:focus, .ring-theme { 
            --tw-ring-color: var(--theme-focus-ring-color);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto glass-container rounded-2xl p-6 md:p-8">
        
        <div id="main-menu">
            <div class="text-center mb-6">
                <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-600 tracking-tight">Formula Challenge</h1>
                <p class="text-gray-600 mt-2 text-lg">Pon a prueba tus conocimientos de formulación.</p>
            </div>
            <div id="stats-container" class="text-center mb-6 p-4 bg-white/50 rounded-lg border border-gray-200"></div>

            <div>
                <h2 class="text-xl font-bold text-center text-theme mb-4">1. Elige el tipo de formulación</h2>
                <div class="flex justify-center gap-4" id="formulation-type-selector">
                    <button data-value="inorganic" class="selection-card p-5 w-full bg-gradient-to-br from-sky-500 to-cyan-400 rounded-xl text-white">
                        <h3 class="text-xl font-bold">Inorgánica</h3>
                    </button>
                    <button data-value="organic" class="selection-card p-5 w-full bg-gradient-to-br from-emerald-500 to-lime-500 rounded-xl text-white">
                        <h3 class="text-xl font-bold">Orgánica</h3>
                    </button>
                </div>
            </div>
            <div class="mt-8">
                <h2 class="text-xl font-bold text-center text-theme mb-4">2. Elige el modo de juego</h2>
                <div class="grid grid-cols-2 gap-4" id="game-mode-selector">
                    <button data-value="formulate" class="selection-card p-5 bg-white/60 rounded-xl border">
                        <h3 class="text-xl font-bold text-gray-800">Formular</h3>
                    </button>
                    <button data-value="name" class="selection-card p-5 bg-white/60 rounded-xl border">
                        <h3 class="text-xl font-bold text-gray-800">Nombrar</h3>
                    </button>
                    <button data-value="correct_error" class="selection-card p-5 bg-white/60 rounded-xl border">
                        <h3 class="text-xl font-bold text-gray-800">Corrige el Error</h3>
                    </button>
                    <button data-value="time_trial" class="selection-card p-5 bg-white/60 rounded-xl border">
                        <h3 class="text-xl font-bold text-gray-800">Contrarreloj</h3>
                    </button>
                </div>
            </div>
            <div class="text-center mt-8">
                <button id="continue-btn" class="btn-primary text-white font-bold py-3 px-10 rounded-lg text-lg">Continuar</button>
            </div>
        </div>

        <div id="category-selection-view" class="hidden fade-in"></div>

        <div id="game-view" class="hidden"></div>
        
        <div id="game-over-view" class="hidden fade-in text-center p-8"></div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA & CONFIG ---
        const compounds = {
            inorganic: {
                'Óxidos': [
                    { formula: 'Fe2O3', name: 'óxido de hierro (III)' }, { formula: 'CuO', name: 'óxido de cobre (II)' }, { formula: 'CO2', name: 'dióxido de carbono' }, { formula: 'N2O5', name: 'pentaóxido de dinitrógeno' }, { formula: 'PbO2', name: 'óxido de plomo (IV)' }
                ],
                'Hidruros Metálicos': [
                    { formula: 'NaH', name: 'hidruro de sodio' }, { formula: 'CaH2', name: 'hidruro de calcio' }, { formula: 'AlH3', name: 'hidruro de aluminio' }, { formula: 'LiH', name: 'hidruro de litio' }
                ],
                'Hidróxidos': [
                    { formula: 'NaOH', name: 'hidróxido de sodio' }, { formula: 'Ca(OH)2', name: 'hidróxido de calcio' }, { formula: 'Fe(OH)3', name: 'hidróxido de hierro (III)' }
                ],
                'Sales Binarias': [
                    { formula: 'NaCl', name: 'cloruro de sodio' }, { formula: 'FeCl3', name: 'cloruro de hierro (III)' }, { formula: 'CaS', name: 'sulfuro de calcio' }, { formula: 'AlBr3', name: 'bromuro de aluminio' }
                ]
            },
            organic: {
                'Alcanos': [
                    { formula: 'CH4', name: 'metano' }, { formula: 'C2H6', name: 'etano' }, { formula: 'C3H8', name: 'propano' }, { formula: 'C4H10', name: 'butano' }, { formula: 'C5H12', name: 'pentano' }
                ],
                'Alquenos': [
                    { formula: 'C2H4', name: 'eteno' }, { formula: 'C3H6', name: 'propeno' }, { formula: 'C4H8', name: 'buteno' },
                ],
                'Alquinos': [
                    { formula: 'C2H2', name: 'etino' }, { formula: 'C3H4', name: 'propino' }, { formula: 'C4H6', name: 'butino' },
                ],
                'Alcoholes': [
                    { formula: 'CH3OH', name: 'metanol' }, { formula: 'C2H5OH', name: 'etanol' }, { formula: 'CH3CH2CH2OH', name: 'propan-1-ol' },
                ]
            }
        };

        const themes = {
            default: {
                '--theme-color-600': '#5dd699', '--theme-color-800': '#10b981', '--theme-gradient-from': '#5dd699',
                '--theme-gradient-to': '#34d399', '--theme-shadow-color': 'rgba(93, 214, 153, 0.5)', '--theme-focus-ring-color': '#5dd699',
                '--theme-bg-from': '#ecfdf5', '--theme-bg-to': '#f0fdfa'
            },
            inorganic: {
                '--theme-color-600': '#0284c7', '--theme-color-800': '#0369a1', '--theme-gradient-from': '#0ea5e9',
                '--theme-gradient-to': '#06b6d4', '--theme-shadow-color': 'rgba(14, 165, 233, 0.5)', '--theme-focus-ring-color': '#0ea5e9',
                '--theme-bg-from': '#bae6fd', '--theme-bg-to': '#a5f3fc'
            },
            organic: {
                '--theme-color-600': '#16a34a', '--theme-color-800': '#14532d', '--theme-gradient-from': '#22c55e',
                '--theme-gradient-to': '#84cc16', '--theme-shadow-color': 'rgba(34, 197, 94, 0.5)', '--theme-focus-ring-color': '#22c55e',
                '--theme-bg-from': '#a7f3d0', '--theme-bg-to': '#d9f99d'
            }
        };

        // --- STATE & DOM ---
        let gameState = {};
        const allViews = {
            mainMenu: document.getElementById('main-menu'),
            categorySelection: document.getElementById('category-selection-view'),
            game: document.getElementById('game-view'),
            gameOver: document.getElementById('game-over-view')
        };
        const formulationTypeSelector = document.getElementById('formulation-type-selector');
        const gameModeSelector = document.getElementById('game-mode-selector');

        // --- THEME & UI FUNCTIONS ---
        const applyThemeColors = (theme = 'default') => {
            const colors = themes[theme];
            Object.entries(colors).forEach(([key, value]) => document.documentElement.style.setProperty(key, value));
        };
        const showView = (viewToShow) => Object.values(allViews).forEach(v => v.classList.toggle('hidden', v !== viewToShow));
        
        const updateStatsDisplay = () => {
            const stats = JSON.parse(localStorage.getItem('formulaChallengeStats')) || { correct: 0, total: 0 };
            const accuracy = stats.total > 0 ? ((stats.correct / stats.total) * 100).toFixed(1) : 0;
            document.getElementById('stats-container').innerHTML = `
                <div class="flex items-center justify-center gap-4">
                    <div>
                        <h3 class="font-bold text-gray-800 text-lg">Estadísticas Globales</h3>
                        <p class="text-sm text-gray-700">Aciertos: <span class="font-semibold text-green-600">${stats.correct}</span> de <span class="font-semibold text-blue-600">${stats.total}</span> | Precisión: <span class="font-semibold text-yellow-600">${accuracy}%</span></p>
                    </div>
                    <button id="reset-stats-btn" class="p-2 rounded-full hover:bg-red-500/10" title="Borrar datos">
                        <svg class="w-5 h-5 text-gray-500 hover:text-red-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>`;
            document.getElementById('reset-stats-btn').addEventListener('click', () => {
                if (confirm('¿Estás seguro? Se borrarán todas tus estadísticas.')) {
                    localStorage.removeItem('formulaChallengeStats');
                    updateStatsDisplay();
                }
            });
        };
        
        // --- SETUP & NAVIGATION ---
        const handleSelection = (selector, selectedBtn) => {
            if (!selectedBtn) return;
            selector.querySelectorAll('.selection-card').forEach(btn => btn.classList.remove('selected'));
            selectedBtn.classList.add('selected');
        };

        formulationTypeSelector.addEventListener('click', e => handleSelection(formulationTypeSelector, e.target.closest('.selection-card')));
        gameModeSelector.addEventListener('click', e => handleSelection(gameModeSelector, e.target.closest('.selection-card')));

        document.getElementById('continue-btn').addEventListener('click', () => {
            const type = formulationTypeSelector.querySelector('.selected')?.dataset.value;
            const mode = gameModeSelector.querySelector('.selected')?.dataset.value;

            if (!type || !mode) {
                alert('Por favor, selecciona el tipo de formulación y el modo de juego.');
                return;
            }

            gameState.type = type;
            gameState.mode = mode;
            applyThemeColors(type);

            const categories = Object.keys(compounds[type]);
            const isTimeTrial = mode === 'time_trial';
            allViews.categorySelection.innerHTML = `
                <h2 class="text-3xl font-bold text-theme mb-2">Configura tu partida</h2>
                <div class="grid grid-cols-1 ${isTimeTrial ? '' : 'md:grid-cols-2'} gap-x-8 gap-y-4">
                    ${!isTimeTrial ? `
                    <div>
                        <h3 class="font-bold text-lg text-gray-700 mb-3">Número de preguntas</h3>
                        <div class="flex justify-center space-x-3" id="question-count-selector">
                            ${[10, 15, 20].map(n => `<button data-value="${n}" class="selection-card w-20 h-14 text-xl font-bold rounded-lg bg-white/60 border">${n}</button>`).join('')}
                        </div>
                    </div>` : ''}
                    <div class="${isTimeTrial ? 'col-span-1' : ''}">
                        <h3 class="font-bold text-lg text-gray-700 mb-3">Categorías de compuestos</h3>
                        <div class="space-y-2 text-left max-w-xs mx-auto" id="category-checkboxes">
                            ${categories.map(cat => `
                                <label class="flex items-center p-3 bg-white/60 rounded-lg border cursor-pointer">
                                    <input type="checkbox" value="${cat}" checked class="h-5 w-5 rounded border-gray-300 text-theme focus:ring-theme">
                                    <span class="ml-3 text-gray-800 font-medium">${cat}</span>
                                </label>`).join('')}
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-center gap-4 mt-8">
                    <button id="back-to-main-btn" class="text-theme hover:text-theme-dark flex items-center gap-1.5">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                        Volver
                    </button>
                    <button id="start-game-btn" class="btn-primary text-white font-bold py-3 px-10 rounded-lg text-lg">Empezar a jugar</button>
                </div>`;
            
            if (!isTimeTrial) {
                document.getElementById('question-count-selector').addEventListener('click', e => handleSelection(document.getElementById('question-count-selector'), e.target.closest('.selection-card')));
                document.querySelector('#question-count-selector button').classList.add('selected');
            }
            document.getElementById('back-to-main-btn').addEventListener('click', () => { applyThemeColors(); showView(allViews.mainMenu); });
            document.getElementById('start-game-btn').addEventListener('click', startGame);
            
            showView(allViews.categorySelection);
        });
        
        // --- GAME LOGIC ---
        let timerInterval;

        const startGame = () => {
            const isTimeTrial = gameState.mode === 'time_trial';
            const count = isTimeTrial ? 999 : parseInt(document.querySelector('#question-count-selector .selected')?.dataset.value);
            const selectedCategories = Array.from(document.querySelectorAll('#category-checkboxes input:checked')).map(cb => cb.value);

            if (!count || selectedCategories.length === 0) {
                alert('Por favor, selecciona un número de preguntas y al menos una categoría.');
                return;
            }

            let questionPool = [];
            selectedCategories.forEach(cat => questionPool.push(...compounds[gameState.type][cat]));
            
            if (questionPool.length === 0) {
                 alert('La categoría seleccionada no tiene compuestos. Por favor, elige otra.');
                 return;
            }

            gameState.totalQuestions = count;
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.questionPool = questionPool;
            gameState.questions = Array.from({ length: count }, () => questionPool[Math.floor(Math.random() * questionPool.length)]);
            if(isTimeTrial) gameState.timeLeft = 60;

            setupGameView();
            nextQuestion();
        };

        const setupGameView = () => {
            const isTimeTrial = gameState.mode === 'time_trial';
            allViews.game.innerHTML = `
                <div class="flex items-center justify-between mb-2 text-base">
                    <button id="back-to-menu-btn" class="text-theme hover:text-theme-dark flex items-center gap-1.5">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                        Salir
                    </button>
                    <div id="game-score" class="font-semibold text-gray-700"></div>
                    ${isTimeTrial ? `<div id="timer" class="font-bold text-2xl text-theme"></div>` : ''}
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2 mb-4"><div id="progress-bar" class="bg-yellow-400 h-2 rounded-full"></div></div>
                <div class="bg-white/50 p-6 rounded-lg text-center border border-gray-200 min-h-[120px] flex flex-col justify-center">
                    <p id="question-text" class="text-gray-600 mb-2 text-lg"></p>
                    <p id="challenge" class="text-3xl md:text-4xl font-bold text-theme tracking-wider"></p>
                </div>
                <div class="mt-6">
                    <input id="answer-input" type="text" class="w-full p-4 text-2xl text-center rounded-lg border focus:ring-2 focus:ring-theme" placeholder="Tu respuesta...">
                </div>
                <div id="feedback" class="mt-4 min-h-[70px]"></div>
                <div class="mt-4 flex justify-center">
                    <button id="check-btn" class="btn-primary px-8 py-3 text-white font-semibold rounded-lg w-full md:w-auto text-lg">Comprobar</button>
                </div>`;
            
            document.getElementById('back-to-menu-btn').addEventListener('click', () => { clearInterval(timerInterval); applyThemeColors(); showView(allViews.mainMenu); });
            const checkBtn = document.getElementById('check-btn');
            const answerInput = document.getElementById('answer-input');

            checkBtn.addEventListener('click', () => (checkBtn.textContent === 'Comprobar') ? checkAnswer() : nextQuestion());
            answerInput.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); checkBtn.click(); }});
            
            showView(allViews.game);
        };

        const generateError = (compound) => {
            const { formula, name } = compound;
            if (Math.random() > 0.5) { // Error in name
                let wrongName = name;
                if (name.includes('(')) {
                    wrongName = name.replace(/\(I+\)/, (match) => (match === '(III)' ? '(II)' : '(III)'));
                } else if (name.includes('óxido')) {
                    wrongName = name.replace('penta', 'di').replace('di', 'tri');
                } else {
                    wrongName = wrongName.replace('ano', 'eno').replace('ol', 'al');
                }
                return { challenge: `<strong>${formula}</strong> se nombra: <br><em>${wrongName}</em>`, answer: name, type: 'name' };
            } else { // Error in formula
                let wrongFormula = formula.replace(/(\d)/, (d) => parseInt(d) + 1);
                if (wrongFormula === formula) wrongFormula = formula + '2';
                return { challenge: `<strong>${name}</strong> tiene la fórmula: <br><em>${wrongFormula}</em>`, answer: formula, type: 'formula' };
            }
        };
        
        const nextQuestion = () => {
            if (gameState.currentQuestion >= gameState.totalQuestions) {
                endGame();
                return;
            }

            const questionData = gameState.questions[gameState.currentQuestion];
            const challengeEl = document.getElementById('challenge');
            const questionTextEl = document.getElementById('question-text');

            if (gameState.mode === 'correct_error') {
                const { challenge, answer, type } = generateError(questionData);
                questionTextEl.textContent = `Hay un error en la ${type === 'name' ? 'nomenclatura' : 'fórmula'}. ¡Corrígelo!`;
                challengeEl.innerHTML = challenge;
                gameState.currentAnswer = answer;
            } else {
                const isFormulateMode = gameState.mode === 'formulate';
                questionTextEl.textContent = isFormulateMode ? 'Escribe la fórmula para:' : 'Nombra el siguiente compuesto:';
                challengeEl.textContent = isFormulateMode ? questionData.name : questionData.formula;
                gameState.currentAnswer = isFormulateMode ? questionData.formula : questionData.name;
            }

            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').disabled = false;
            document.getElementById('answer-input').focus();
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('check-btn').textContent = 'Comprobar';
            document.getElementById('check-btn').disabled = false;
            
            if (gameState.mode === 'time_trial' && !timerInterval) startTimer();
            updateGameUI();
            gameState.currentQuestion++;
        };

        const checkAnswer = () => {
            const userAnswer = document.getElementById('answer-input').value.trim().toLowerCase();
            const correctAnswer = gameState.currentAnswer.toLowerCase();
            const isCorrect = userAnswer === correctAnswer;
            
            if (isCorrect) {
                gameState.score++;
                if (gameState.mode === 'time_trial') gameState.timeLeft += 3;
            } else {
                if (gameState.mode === 'time_trial') gameState.timeLeft -= 2;
            }

            document.getElementById('answer-input').disabled = true;
            document.getElementById('check-btn').textContent = 'Siguiente';

            const feedbackEl = document.getElementById('feedback');
            feedbackEl.innerHTML = `
                <div class="p-4 rounded-lg ${isCorrect ? 'bg-green-100 border-green-300' : 'bg-red-100 border-red-300'} border">
                    <h3 class="font-bold ${isCorrect ? 'text-green-800' : 'text-red-800'}">${isCorrect ? '¡Correcto!' : 'Incorrecto'}</h3>
                    ${!isCorrect ? `<p class="text-gray-700 mt-1">La respuesta correcta es: <strong class="text-theme">${gameState.currentAnswer}</strong></p>` : ''}
                </div>`;
            updateGameUI();
        };

        const startTimer = () => {
            const timerEl = document.getElementById('timer');
            timerInterval = setInterval(() => {
                gameState.timeLeft--;
                timerEl.textContent = `${gameState.timeLeft}s`;
                if (gameState.timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    endGame();
                }
            }, 1000);
        };
        
        const updateGameUI = () => {
            if (gameState.mode === 'time_trial') {
                document.getElementById('game-score').textContent = `Aciertos: ${gameState.score}`;
            } else {
                const progress = (gameState.currentQuestion / gameState.totalQuestions) * 100;
                document.getElementById('progress-bar').style.width = `${progress}%`;
                document.getElementById('game-score').textContent = `Pregunta: ${gameState.currentQuestion} / ${gameState.totalQuestions} | Aciertos: ${gameState.score}`;
            }
        };

        const endGame = () => {
            clearInterval(timerInterval);
            timerInterval = null;
            const stats = JSON.parse(localStorage.getItem('formulaChallengeStats')) || { correct: 0, total: 0 };
            stats.correct += gameState.score;
            stats.total += gameState.mode === 'time_trial' ? gameState.currentQuestion -1 : gameState.totalQuestions;
            localStorage.setItem('formulaChallengeStats', JSON.stringify(stats));

            allViews.gameOver.innerHTML = `
                <h2 class="text-3xl font-bold text-theme mb-4">¡Partida Terminada!</h2>
                <p class="text-xl text-gray-700 mb-8">Tu puntuación fue: ${gameState.score} aciertos.</p>
                <button id="play-again-btn" class="btn-primary text-white font-bold py-3 px-10 rounded-lg text-lg">Jugar de Nuevo</button>`;
            
            document.getElementById('play-again-btn').addEventListener('click', () => {
                applyThemeColors();
                updateStatsDisplay();
                showView(allViews.mainMenu);
            });
            showView(allViews.gameOver);
        };

        // --- INITIALIZATION ---
        applyThemeColors();
        updateStatsDisplay();
        showView(allViews.mainMenu);
        formulationTypeSelector.querySelector('[data-value="inorganic"]').classList.add('selected');
        gameModeSelector.querySelector('[data-value="formulate"]').classList.add('selected');
    });
    </script>
</body>
</html>

